using System;
using System.Collections.Generic;
using System.Linq;
using System.Web;
using System.Web.UI;
using System.Web.UI.WebControls;
using System.Data;
using System.Data.SqlClient;
using System.Text;
using System.Configuration;

namespace Balanced_Scorecard
{
    public partial class view_kpi_history_detail : System.Web.UI.Page
    {
        string str_connect = ConfigurationManager.ConnectionStrings["MyConnection"].ConnectionString;
        protected void Page_Load(object sender, EventArgs e)
        {
            if (!IsPostBack)
            {
                if (Session["user_name"] == null)
                {
                    Response.Redirect("~/index.aspx");
                }
                ((Label)Master.FindControl("LabelUsername")).Text = Session["user_name"].ToString();//untuk akses Master Page

                StringBuilder HtmlCurrentKPI = new StringBuilder();
                StringBuilder HtmlNewKPI = new StringBuilder();
                StringBuilder Pagination = new StringBuilder();//untuk Pagination

                var page = Request.QueryString["page"];//untuk pagination
                var request_id = Request.QueryString["request_id"];
                var period_id = Request.QueryString["period_id"];

                var req_nik = Request.QueryString["req_nik"];
                var req_name = Request.QueryString["req_name"];
                var req_org = Request.QueryString["req_org"];
                var req_adt_org = Request.QueryString["req_adt_org"];
                var app_nik = Request.QueryString["app_nik"];
                var app_name = Request.QueryString["app_name"];

                if (req_nik == null && req_name == null && req_org == null && req_adt_org == null && app_nik == null && app_name == null)
                {
                    breadcrumb_change_request_kpi.Attributes.Add("href", "request_change_kpi_history.aspx?page=" + page + "&period_id=" + period_id + "");
                    hrefBackToKPIChangeRequest.Attributes.Add("href", "request_change_kpi_history.aspx?page=" + page + "&period_id=" + period_id + "");
                }
                else if (req_nik != null && req_name == null && req_org == null && req_adt_org == null && app_nik == null && app_name == null)
                {
                    breadcrumb_change_request_kpi.Attributes.Add("href", "request_change_kpi_history.aspx?page=" + page + "&period_id=" + period_id + "&req_nik=" + req_nik + "");
                    hrefBackToKPIChangeRequest.Attributes.Add("href", "request_change_kpi_history.aspx?page=" + page + "&period_id=" + period_id + "&req_nik=" + req_nik + "");
                }
                else if (req_nik == null && req_name != null && req_org == null && req_adt_org == null && app_nik == null && app_name == null)
                {
                    breadcrumb_change_request_kpi.Attributes.Add("href", "request_change_kpi_history.aspx?page=" + page + "&period_id=" + period_id + "&req_name=" + req_name + "");
                    hrefBackToKPIChangeRequest.Attributes.Add("href", "request_change_kpi_history.aspx?page=" + page + "&period_id=" + period_id + "&req_name=" + req_name + "");
                }
                else if (req_nik == null && req_name == null && req_org != null && req_adt_org == null && app_nik == null && app_name == null)
                {
                    breadcrumb_change_request_kpi.Attributes.Add("href", "request_change_kpi_history.aspx?page=" + page + "&period_id=" + period_id + "&req_org=" + req_org + "");
                    hrefBackToKPIChangeRequest.Attributes.Add("href", "request_change_kpi_history.aspx?page=" + page + "&period_id=" + period_id + "&req_org=" + req_org + "");
                }
                else if (req_nik == null && req_name == null && req_org == null && req_adt_org != null && app_nik == null && app_name == null)
                {
                    breadcrumb_change_request_kpi.Attributes.Add("href", "request_change_kpi_history.aspx?page=" + page + "&period_id=" + period_id + "&req_adt_org=" + req_adt_org + "");
                    hrefBackToKPIChangeRequest.Attributes.Add("href", "request_change_kpi_history.aspx?page=" + page + "&period_id=" + period_id + "&req_adt_org=" + req_adt_org + "");
                }
                else if (req_nik == null && req_name == null && req_org == null && req_adt_org == null && app_nik != null && app_name == null)
                {
                    breadcrumb_change_request_kpi.Attributes.Add("href", "request_change_kpi_history.aspx?page=" + page + "&period_id=" + period_id + "&app_nik=" + app_nik + "");
                    hrefBackToKPIChangeRequest.Attributes.Add("href", "request_change_kpi_history.aspx?page=" + page + "&period_id=" + period_id + "&app_nik=" + app_nik + "");
                }
                else if (req_nik == null && req_name == null && req_org == null && req_adt_org == null && app_nik == null && app_name != null)
                {
                    breadcrumb_change_request_kpi.Attributes.Add("href", "request_change_kpi_history.aspx?page=" + page + "&period_id=" + period_id + "&app_name=" + app_name + "");
                    hrefBackToKPIChangeRequest.Attributes.Add("href", "request_change_kpi_history.aspx?page=" + page + "&period_id=" + period_id + "&app_name=" + app_name + "");
                }

                using (SqlConnection conn = new SqlConnection(str_connect))
                {
                    conn.Open();
                    string delete_bool = "", reason = "";
                    string string_get_current_kpi = "SELECT * FROM IndividualHeaderHistory WHERE IndividualHeaderRequest_ID=" + request_id + "";
                    string string_get_new_kpi = "SELECT * FROM IndividualHeader_RequestChange WHERE IndividualHeaderRequest_ID=" + request_id + "";
                    SqlCommand sql_get_current_kpi = new SqlCommand(string_get_current_kpi, conn);
                    SqlCommand sql_get_new_kpi = new SqlCommand(string_get_new_kpi, conn);

                    using (SqlDataReader DeleteBoolReader = sql_get_new_kpi.ExecuteReader())
                    {
                        while (DeleteBoolReader.Read())
                        {
                            delete_bool = DeleteBoolReader["delete_flag"].ToString();
                            reason = DeleteBoolReader["IndividualHeaderReason"].ToString();
                        }
                        DeleteBoolReader.Dispose();
                        DeleteBoolReader.Close();
                    }

                    if (delete_bool == "0")
                    {
                        HtmlCurrentKPI.Append("<div class='panel panel-primary' id='Div1'>");
                        HtmlCurrentKPI.Append("<div class='panel-heading'><p class='csc_p'>Before Change</p></div>");
                        HtmlCurrentKPI.Append("<div class='table-responsive' id='BeforeTable'>");
                        HtmlCurrentKPI.Append("<table class='table table-bordered'>");

                        using (SqlDataReader CurrentReader = sql_get_current_kpi.ExecuteReader())
                        {
                            if (CurrentReader.HasRows)
                            {
                                HtmlCurrentKPI.Append("<tr>");
                                HtmlCurrentKPI.Append("<th class='centering-th-period'>KPI</th>");
                                HtmlCurrentKPI.Append("<th class='centering-th-period'>Objective</th>");
                                HtmlCurrentKPI.Append("<th class='centering-th-period'>Target</th>");
                                HtmlCurrentKPI.Append("<th class='centering-th-period'>Result</th>");
                                HtmlCurrentKPI.Append("<th class='centering-th-period'>Formula</th>");
                                HtmlCurrentKPI.Append("<th class='centering-th-period'>Rating</th>");
                                HtmlCurrentKPI.Append("<th class='centering-th-period'>Weight</th>");
                                HtmlCurrentKPI.Append("<th class='centering-th-period'>Score</th>");
                                HtmlCurrentKPI.Append("</tr>");
                                while (CurrentReader.Read())
                                {
                                    if (CurrentReader["IndividualHeader_MeasureBy"].ToString() == "Month")
                                    {
                                        string month_name_target, month_name_result;
                                        month_name_target = ShowMonthName(int.Parse(CurrentReader["IndividualHeader_Target"].ToString()));
                                        month_name_result = ShowMonthName(int.Parse(CurrentReader["IndividualHeader_Result"].ToString()));

                                        HtmlCurrentKPI.Append("<tr>");
                                        HtmlCurrentKPI.Append("<td class='td-align' align='center'>" + CurrentReader["IndividualHeader_KPI"] + "</td>");
                                        HtmlCurrentKPI.Append("<td class='td-align' align='center'>" + CurrentReader["IndividualHeader_Objective"] + "</td>");
                                        HtmlCurrentKPI.Append("<td class='td-align' align='center'>" + month_name_target + "</td>");
                                        HtmlCurrentKPI.Append("<td class='td-align' align='center'>" + month_name_result + "</td>");
                                        HtmlCurrentKPI.Append("<td class='td-align' align='center'>" + CurrentReader["IndividualHeader_Formula"] + "</td>");
                                        HtmlCurrentKPI.Append("<td class='td-align' align='center'>" + CurrentReader["IndividualHeader_Rating"] + "%</td>");
                                        HtmlCurrentKPI.Append("<td class='td-align' align='center'>" + CurrentReader["IndividualHeader_Weight"] + "%</td>");
                                        HtmlCurrentKPI.Append("<td class='td-align' align='center'>" + CurrentReader["IndividualHeader_Score"] + "%</td>");
                                        HtmlCurrentKPI.Append("</tr>");
                                    }
                                    else if (CurrentReader["IndividualHeader_MeasureBy"].ToString() == "Numbers")
                                    {
                                        HtmlCurrentKPI.Append("<tr>");
                                        HtmlCurrentKPI.Append("<td class='td-align' align='center'>" + CurrentReader["IndividualHeader_KPI"] + "</td>");
                                        HtmlCurrentKPI.Append("<td class='td-align' align='center'>" + CurrentReader["IndividualHeader_Objective"] + "</td>");
                                        HtmlCurrentKPI.Append("<td class='td-align' align='center'>" + CurrentReader["IndividualHeader_Target"] + "</td>");
                                        HtmlCurrentKPI.Append("<td class='td-align' align='center'>" + CurrentReader["IndividualHeader_Result"] + "</td>");
                                        HtmlCurrentKPI.Append("<td class='td-align' align='center'>" + CurrentReader["IndividualHeader_Formula"] + "</td>");
                                        HtmlCurrentKPI.Append("<td class='td-align' align='center'>" + CurrentReader["IndividualHeader_Rating"] + "%</td>");
                                        HtmlCurrentKPI.Append("<td class='td-align' align='center'>" + CurrentReader["IndividualHeader_Weight"] + "%</td>");
                                        HtmlCurrentKPI.Append("<td class='td-align' align='center'>" + CurrentReader["IndividualHeader_Score"] + "%</td>");
                                        HtmlCurrentKPI.Append("</tr>");
                                    }
                                    else
                                    {
                                        string based_on_schedule = "", string_result = "";

                                        if (CurrentReader["IndividualHeader_Target"].ToString() == "-1")
                                        {
                                            based_on_schedule = "Based On Schedule";
                                        }
                                        else
                                        {
                                            based_on_schedule = CurrentReader["IndividualHeader_Target"].ToString() + " " + CurrentReader["IndividualHeader_MeasureBy"].ToString();
                                        }

                                        if (CurrentReader["IndividualHeader_MeasureBy"].ToString() == "-")
                                        {
                                            string_result = "-";
                                        }
                                        else
                                        {
                                            string_result = CurrentReader["IndividualHeader_Result"].ToString() + " " + CurrentReader["IndividualHeader_MeasureBy"].ToString();
                                        }

                                        HtmlCurrentKPI.Append("<tr>");
                                        HtmlCurrentKPI.Append("<td class='td-align' align='center'>" + CurrentReader["IndividualHeader_KPI"] + "</td>");
                                        HtmlCurrentKPI.Append("<td class='td-align' align='center'>" + CurrentReader["IndividualHeader_Objective"] + "</td>");
                                        HtmlCurrentKPI.Append("<td class='td-align' align='center'>" + based_on_schedule + "</td>");
                                        HtmlCurrentKPI.Append("<td class='td-align' align='center'>" + string_result + "</td>");
                                        HtmlCurrentKPI.Append("<td class='td-align' align='center'>" + CurrentReader["IndividualHeader_Formula"] + "</td>");
                                        HtmlCurrentKPI.Append("<td class='td-align' align='center'>" + CurrentReader["IndividualHeader_Rating"] + "%</td>");
                                        HtmlCurrentKPI.Append("<td class='td-align' align='center'>" + CurrentReader["IndividualHeader_Weight"] + "%</td>");
                                        HtmlCurrentKPI.Append("<td class='td-align' align='center'>" + CurrentReader["IndividualHeader_Score"] + "%</td>");
                                        HtmlCurrentKPI.Append("</tr>");

                                    }
                                }//end of While
                            }//end of if(HasRows)
                            else//jika tidak ada data period sama sekali
                            {
                                HtmlCurrentKPI.Append("<tr align='center'>");
                                HtmlCurrentKPI.Append("<th class='centering-th-period' colspan='9'>There is no data to display</th>");
                                HtmlCurrentKPI.Append("</tr>");
                            }
                            HtmlCurrentKPI.Append("</table>");
                            HtmlCurrentKPI.Append("</div>");
                            HtmlCurrentKPI.Append("</div>");
                            CurrentReader.Dispose();
                            CurrentReader.Close();
                        }//end of SqlDataReader CurrentReader
                        PlaceHolderBefore.Controls.Add(new Literal { Text = HtmlCurrentKPI.ToString() });//menampilkan table period

                        HtmlNewKPI.Append("<div class='panel panel-primary' id='Div2'>");
                        HtmlNewKPI.Append("<div class='panel-heading'><p class='csc_p'>After Change</p></div>");
                        HtmlNewKPI.Append("<div class='table-responsive' id='AfterTable'>");
                        HtmlNewKPI.Append("<table class='table table-bordered'>");
                        using (SqlDataReader NewReader = sql_get_new_kpi.ExecuteReader())
                        {
                            if (NewReader.HasRows)
                            {
                                HtmlNewKPI.Append("<tr>");
                                HtmlNewKPI.Append("<th class='centering-th-period'>KPI</th>");
                                HtmlNewKPI.Append("<th class='centering-th-period'>Objective</th>");
                                HtmlNewKPI.Append("<th class='centering-th-period'>Target</th>");
                                HtmlNewKPI.Append("<th class='centering-th-period'>Result</th>");
                                HtmlNewKPI.Append("<th class='centering-th-period'>Formula</th>");
                                HtmlNewKPI.Append("<th class='centering-th-period'>Rating</th>");
                                HtmlNewKPI.Append("<th class='centering-th-period'>Weight</th>");
                                HtmlNewKPI.Append("<th class='centering-th-period'>Score</th>");
                                HtmlNewKPI.Append("</tr>");
                                while (NewReader.Read())
                                {
                                    LabelReason.Text = NewReader["IndividualHeaderReason"].ToString();
                                    if (NewReader["IndividualHeader_MeasureBy"].ToString() == "Month")
                                    {
                                        string month_name_target, month_name_result;
                                        month_name_target = ShowMonthName(int.Parse(NewReader["IndividualHeader_Target"].ToString()));
                                        month_name_result = ShowMonthName(int.Parse(NewReader["IndividualHeader_Result"].ToString()));

                                        HtmlNewKPI.Append("<tr>");
                                        HtmlNewKPI.Append("<td class='td-align' align='center'>" + NewReader["IndividualHeader_KPI"] + "</td>");
                                        HtmlNewKPI.Append("<td class='td-align' align='center'>" + NewReader["IndividualHeader_Objective"] + "</td>");
                                        HtmlNewKPI.Append("<td class='td-align' align='center'>" + month_name_target + "</td>");
                                        HtmlNewKPI.Append("<td class='td-align' align='center'>" + month_name_result + "</td>");
                                        HtmlNewKPI.Append("<td class='td-align' align='center'>" + NewReader["IndividualHeader_Formula"] + "</td>");
                                        HtmlNewKPI.Append("<td class='td-align' align='center'>" + NewReader["IndividualHeader_Rating"] + "%</td>");
                                        HtmlNewKPI.Append("<td class='td-align' align='center'>" + NewReader["IndividualHeader_Weight"] + "%</td>");
                                        HtmlNewKPI.Append("<td class='td-align' align='center'>" + NewReader["IndividualHeader_Score"] + "%</td>");
                                        HtmlNewKPI.Append("</tr>");
                                    }
                                    else if (NewReader["IndividualHeader_MeasureBy"].ToString() == "Numbers")
                                    {
                                        HtmlNewKPI.Append("<tr>");
                                        HtmlNewKPI.Append("<td class='td-align' align='center'>" + NewReader["IndividualHeader_KPI"] + "</td>");
                                        HtmlNewKPI.Append("<td class='td-align' align='center'>" + NewReader["IndividualHeader_Objective"] + "</td>");
                                        HtmlNewKPI.Append("<td class='td-align' align='center'>" + NewReader["IndividualHeader_Target"] + "</td>");
                                        HtmlNewKPI.Append("<td class='td-align' align='center'>" + NewReader["IndividualHeader_Result"] + "</td>");
                                        HtmlNewKPI.Append("<td class='td-align' align='center'>" + NewReader["IndividualHeader_Formula"] + "</td>");
                                        HtmlNewKPI.Append("<td class='td-align' align='center'>" + NewReader["IndividualHeader_Rating"] + "%</td>");
                                        HtmlNewKPI.Append("<td class='td-align' align='center'>" + NewReader["IndividualHeader_Weight"] + "%</td>");
                                        HtmlNewKPI.Append("<td class='td-align' align='center'>" + NewReader["IndividualHeader_Score"] + "%</td>");
                                        HtmlNewKPI.Append("</tr>");
                                    }
                                    else
                                    {
                                        string based_on_schedule = "", string_result = "";

                                        if (NewReader["IndividualHeader_Target"].ToString() == "-1")
                                        {
                                            based_on_schedule = "Based On Schedule";
                                        }
                                        else
                                        {
                                            based_on_schedule = NewReader["IndividualHeader_Target"].ToString() + " " + NewReader["IndividualHeader_MeasureBy"].ToString();
                                        }

                                        if (NewReader["IndividualHeader_MeasureBy"].ToString() == "-")
                                        {
                                            string_result = "-";
                                        }
                                        else
                                        {
                                            string_result = NewReader["IndividualHeader_Result"].ToString() + " " + NewReader["IndividualHeader_MeasureBy"].ToString();
                                        }

                                        HtmlNewKPI.Append("<tr>");
                                        HtmlNewKPI.Append("<td class='td-align' align='center'>" + NewReader["IndividualHeader_KPI"] + "</td>");
                                        HtmlNewKPI.Append("<td class='td-align' align='center'>" + NewReader["IndividualHeader_Objective"] + "</td>");
                                        HtmlNewKPI.Append("<td class='td-align' align='center'>" + based_on_schedule + "</td>");
                                        HtmlNewKPI.Append("<td class='td-align' align='center'>" + string_result + "</td>");
                                        HtmlNewKPI.Append("<td class='td-align' align='center'>" + NewReader["IndividualHeader_Formula"] + "</td>");
                                        HtmlNewKPI.Append("<td class='td-align' align='center'>" + NewReader["IndividualHeader_Rating"] + "%</td>");
                                        HtmlNewKPI.Append("<td class='td-align' align='center'>" + NewReader["IndividualHeader_Weight"] + "%</td>");
                                        HtmlNewKPI.Append("<td class='td-align' align='center'>" + NewReader["IndividualHeader_Score"] + "%</td>");
                                        HtmlNewKPI.Append("</tr>");
                                    }
                                }//end of While
                            }//end of if(HasRows)
                            else//jika tidak ada data period sama sekali
                            {
                                HtmlNewKPI.Append("<tr align='center'>");
                                HtmlNewKPI.Append("<th class='centering-th-period' colspan='9'>There is no data to display</th>");
                                HtmlNewKPI.Append("</tr>");
                            }
                            HtmlNewKPI.Append("</table>");
                            HtmlNewKPI.Append("</div>");
                            HtmlNewKPI.Append("</div>");
                            NewReader.Dispose();
                            NewReader.Close();
                        }//end of SqlDataReader NewReader

                        PlaceHolderAfter.Controls.Add(new Literal { Text = HtmlNewKPI.ToString() });//menampilkan table period
                    }
                    else if (delete_bool == "1")
                    {
                        LabelReason.Text = reason;
                        //placeholder delete KPI
                        HtmlCurrentKPI.Append("<div class='panel panel-primary' id='Div1'>");
                        HtmlCurrentKPI.Append("<div class='panel-heading'><p class='csc_p'>Wants to delete:</p></div>");
                        HtmlCurrentKPI.Append("<div class='table-responsive' id='BeforeTable'>");
                        HtmlCurrentKPI.Append("<table class='table table-bordered'>");

                        using (SqlDataReader CurrentReader = sql_get_current_kpi.ExecuteReader())
                        {
                            if (CurrentReader.HasRows)
                            {
                                HtmlCurrentKPI.Append("<tr>");
                                HtmlCurrentKPI.Append("<th class='centering-th-period'>KPI</th>");
                                HtmlCurrentKPI.Append("<th class='centering-th-period'>Objective</th>");
                                HtmlCurrentKPI.Append("<th class='centering-th-period'>Target</th>");
                                HtmlCurrentKPI.Append("<th class='centering-th-period'>Result</th>");
                                HtmlCurrentKPI.Append("<th class='centering-th-period'>Formula</th>");
                                HtmlCurrentKPI.Append("<th class='centering-th-period'>Rating</th>");
                                HtmlCurrentKPI.Append("<th class='centering-th-period'>Weight</th>");
                                HtmlCurrentKPI.Append("<th class='centering-th-period'>Score</th>");
                                HtmlCurrentKPI.Append("</tr>");
                                while (CurrentReader.Read())
                                {
                                    if (CurrentReader["IndividualHeader_MeasureBy"].ToString() == "Month")
                                    {
                                        string month_name_target, month_name_result;
                                        month_name_target = ShowMonthName(int.Parse(CurrentReader["IndividualHeader_Target"].ToString()));
                                        month_name_result = ShowMonthName(int.Parse(CurrentReader["IndividualHeader_Result"].ToString()));

                                        HtmlCurrentKPI.Append("<tr>");
                                        HtmlCurrentKPI.Append("<td class='td-align' align='center'>" + CurrentReader["IndividualHeader_KPI"] + "</td>");
                                        HtmlCurrentKPI.Append("<td class='td-align' align='center'>" + CurrentReader["IndividualHeader_Objective"] + "</td>");
                                        HtmlCurrentKPI.Append("<td class='td-align' align='center'>" + month_name_target + "</td>");
                                        HtmlCurrentKPI.Append("<td class='td-align' align='center'>" + month_name_result + "</td>");
                                        HtmlCurrentKPI.Append("<td class='td-align' align='center'>" + CurrentReader["IndividualHeader_Formula"] + "</td>");
                                        HtmlCurrentKPI.Append("<td class='td-align' align='center'>" + CurrentReader["IndividualHeader_Rating"] + "%</td>");
                                        HtmlCurrentKPI.Append("<td class='td-align' align='center'>" + CurrentReader["IndividualHeader_Weight"] + "%</td>");
                                        HtmlCurrentKPI.Append("<td class='td-align' align='center'>" + CurrentReader["IndividualHeader_Score"] + "%</td>");
                                        HtmlCurrentKPI.Append("</tr>");
                                    }
                                    else if (CurrentReader["IndividualHeader_MeasureBy"].ToString() == "Numbers")
                                    {
                                        HtmlCurrentKPI.Append("<tr>");
                                        HtmlCurrentKPI.Append("<td class='td-align' align='center'>" + CurrentReader["IndividualHeader_KPI"] + "</td>");
                                        HtmlCurrentKPI.Append("<td class='td-align' align='center'>" + CurrentReader["IndividualHeader_Objective"] + "</td>");
                                        HtmlCurrentKPI.Append("<td class='td-align' align='center'>" + CurrentReader["IndividualHeader_Target"] + "</td>");
                                        HtmlCurrentKPI.Append("<td class='td-align' align='center'>" + CurrentReader["IndividualHeader_Result"] + "</td>");
                                        HtmlCurrentKPI.Append("<td class='td-align' align='center'>" + CurrentReader["IndividualHeader_Formula"] + "</td>");
                                        HtmlCurrentKPI.Append("<td class='td-align' align='center'>" + CurrentReader["IndividualHeader_Rating"] + "%</td>");
                                        HtmlCurrentKPI.Append("<td class='td-align' align='center'>" + CurrentReader["IndividualHeader_Weight"] + "%</td>");
                                        HtmlCurrentKPI.Append("<td class='td-align' align='center'>" + CurrentReader["IndividualHeader_Score"] + "%</td>");
                                        HtmlCurrentKPI.Append("</tr>");
                                    }
                                    else
                                    {
                                        string based_on_schedule = "", string_result = "";

                                        if (CurrentReader["IndividualHeader_Target"].ToString() == "-1")
                                        {
                                            based_on_schedule = "Based On Schedule";
                                        }
                                        else
                                        {
                                            based_on_schedule = CurrentReader["IndividualHeader_Target"].ToString() + " " + CurrentReader["IndividualHeader_MeasureBy"].ToString();
                                        }

                                        if (CurrentReader["IndividualHeader_MeasureBy"].ToString() == "-")
                                        {
                                            string_result = "-";
                                        }
                                        else
                                        {
                                            string_result = CurrentReader["IndividualHeader_Result"].ToString() + " " + CurrentReader["IndividualHeader_MeasureBy"].ToString();
                                        }

                                        HtmlCurrentKPI.Append("<tr>");
                                        HtmlCurrentKPI.Append("<td class='td-align' align='center'>" + CurrentReader["IndividualHeader_KPI"] + "</td>");
                                        HtmlCurrentKPI.Append("<td class='td-align' align='center'>" + CurrentReader["IndividualHeader_Objective"] + "</td>");
                                        HtmlCurrentKPI.Append("<td class='td-align' align='center'>" + based_on_schedule + "</td>");
                                        HtmlCurrentKPI.Append("<td class='td-align' align='center'>" + string_result + "</td>");
                                        HtmlCurrentKPI.Append("<td class='td-align' align='center'>" + CurrentReader["IndividualHeader_Formula"] + "</td>");
                                        HtmlCurrentKPI.Append("<td class='td-align' align='center'>" + CurrentReader["IndividualHeader_Rating"] + "%</td>");
                                        HtmlCurrentKPI.Append("<td class='td-align' align='center'>" + CurrentReader["IndividualHeader_Weight"] + "%</td>");
                                        HtmlCurrentKPI.Append("<td class='td-align' align='center'>" + CurrentReader["IndividualHeader_Score"] + "%</td>");
                                        HtmlCurrentKPI.Append("</tr>");
                                    }
                                }//end of While
                            }//end of if(HasRows)
                            else//jika tidak ada data period sama sekali
                            {
                                HtmlCurrentKPI.Append("<tr align='center'>");
                                HtmlCurrentKPI.Append("<th class='centering-th-period' colspan='9'>There is no data to display</th>");
                                HtmlCurrentKPI.Append("</tr>");
                            }
                            HtmlCurrentKPI.Append("</table>");
                            HtmlCurrentKPI.Append("</div>");
                            HtmlCurrentKPI.Append("</div>");
                            CurrentReader.Dispose();
                            CurrentReader.Close();
                        }//end of SqlDataReader CurrentReader
                        PlaceHolderBefore.Controls.Add(new Literal { Text = HtmlCurrentKPI.ToString() });//menampilkan table period
                    }
                    else if (delete_bool == "2")
                    {
                        LabelReason.Text = reason;
                        //placeholder delete KPI
                        HtmlCurrentKPI.Append("<div class='panel panel-primary' id='Div1'>");
                        HtmlCurrentKPI.Append("<div class='panel-heading'><p class='csc_p'>Wants to add:</p></div>");
                        HtmlCurrentKPI.Append("<div class='table-responsive' id='BeforeTable'>");
                        HtmlCurrentKPI.Append("<table class='table table-bordered'>");

                        using (SqlDataReader CurrentReader = sql_get_current_kpi.ExecuteReader())
                        {
                            if (CurrentReader.HasRows)
                            {
                                HtmlCurrentKPI.Append("<tr>");
                                HtmlCurrentKPI.Append("<th class='centering-th-period'>KPI</th>");
                                HtmlCurrentKPI.Append("<th class='centering-th-period'>Objective</th>");
                                HtmlCurrentKPI.Append("<th class='centering-th-period'>Target</th>");
                                HtmlCurrentKPI.Append("<th class='centering-th-period'>Result</th>");
                                HtmlCurrentKPI.Append("<th class='centering-th-period'>Formula</th>");
                                HtmlCurrentKPI.Append("<th class='centering-th-period'>Rating</th>");
                                HtmlCurrentKPI.Append("<th class='centering-th-period'>Weight</th>");
                                HtmlCurrentKPI.Append("<th class='centering-th-period'>Score</th>");
                                HtmlCurrentKPI.Append("</tr>");
                                while (CurrentReader.Read())
                                {
                                    if (CurrentReader["IndividualHeader_MeasureBy"].ToString() == "Month")
                                    {
                                        string month_name_target, month_name_result;
                                        month_name_target = ShowMonthName(int.Parse(CurrentReader["IndividualHeader_Target"].ToString()));
                                        month_name_result = ShowMonthName(int.Parse(CurrentReader["IndividualHeader_Result"].ToString()));

                                        HtmlCurrentKPI.Append("<tr>");
                                        HtmlCurrentKPI.Append("<td class='td-align' align='center'>" + CurrentReader["IndividualHeader_KPI"] + "</td>");
                                        HtmlCurrentKPI.Append("<td class='td-align' align='center'>" + CurrentReader["IndividualHeader_Objective"] + "</td>");
                                        HtmlCurrentKPI.Append("<td class='td-align' align='center'>" + month_name_target + "</td>");
                                        HtmlCurrentKPI.Append("<td class='td-align' align='center'>" + month_name_result + "</td>");
                                        HtmlCurrentKPI.Append("<td class='td-align' align='center'>" + CurrentReader["IndividualHeader_Formula"] + "</td>");
                                        HtmlCurrentKPI.Append("<td class='td-align' align='center'>" + CurrentReader["IndividualHeader_Rating"] + "%</td>");
                                        HtmlCurrentKPI.Append("<td class='td-align' align='center'>" + CurrentReader["IndividualHeader_Weight"] + "%</td>");
                                        HtmlCurrentKPI.Append("<td class='td-align' align='center'>" + CurrentReader["IndividualHeader_Score"] + "%</td>");
                                        HtmlCurrentKPI.Append("</tr>");
                                    }
                                    else if (CurrentReader["IndividualHeader_MeasureBy"].ToString() == "Numbers")
                                    {
                                        HtmlCurrentKPI.Append("<tr>");
                                        HtmlCurrentKPI.Append("<td class='td-align' align='center'>" + CurrentReader["IndividualHeader_KPI"] + "</td>");
                                        HtmlCurrentKPI.Append("<td class='td-align' align='center'>" + CurrentReader["IndividualHeader_Objective"] + "</td>");
                                        HtmlCurrentKPI.Append("<td class='td-align' align='center'>" + CurrentReader["IndividualHeader_Target"] + "</td>");
                                        HtmlCurrentKPI.Append("<td class='td-align' align='center'>" + CurrentReader["IndividualHeader_Result"] + "</td>");
                                        HtmlCurrentKPI.Append("<td class='td-align' align='center'>" + CurrentReader["IndividualHeader_Formula"] + "</td>");
                                        HtmlCurrentKPI.Append("<td class='td-align' align='center'>" + CurrentReader["IndividualHeader_Rating"] + "%</td>");
                                        HtmlCurrentKPI.Append("<td class='td-align' align='center'>" + CurrentReader["IndividualHeader_Weight"] + "%</td>");
                                        HtmlCurrentKPI.Append("<td class='td-align' align='center'>" + CurrentReader["IndividualHeader_Score"] + "%</td>");
                                        HtmlCurrentKPI.Append("</tr>");
                                    }
                                    else
                                    {
                                        string based_on_schedule = "", string_result = "";

                                        if (CurrentReader["IndividualHeader_Target"].ToString() == "-1")
                                        {
                                            based_on_schedule = "Based On Schedule";
                                        }
                                        else
                                        {
                                            based_on_schedule = CurrentReader["IndividualHeader_Target"].ToString() + " " + CurrentReader["IndividualHeader_MeasureBy"].ToString();
                                        }

                                        if (CurrentReader["IndividualHeader_MeasureBy"].ToString() == "-")
                                        {
                                            string_result = "-";
                                        }
                                        else
                                        {
                                            string_result = CurrentReader["IndividualHeader_Result"].ToString() + " " + CurrentReader["IndividualHeader_MeasureBy"].ToString();
                                        }

                                        HtmlCurrentKPI.Append("<tr>");
                                        HtmlCurrentKPI.Append("<td class='td-align' align='center'>" + CurrentReader["IndividualHeader_KPI"] + "</td>");
                                        HtmlCurrentKPI.Append("<td class='td-align' align='center'>" + CurrentReader["IndividualHeader_Objective"] + "</td>");
                                        HtmlCurrentKPI.Append("<td class='td-align' align='center'>" + based_on_schedule + "</td>");
                                        HtmlCurrentKPI.Append("<td class='td-align' align='center'>" + string_result + "</td>");
                                        HtmlCurrentKPI.Append("<td class='td-align' align='center'>" + CurrentReader["IndividualHeader_Formula"] + "</td>");
                                        HtmlCurrentKPI.Append("<td class='td-align' align='center'>" + CurrentReader["IndividualHeader_Rating"] + "%</td>");
                                        HtmlCurrentKPI.Append("<td class='td-align' align='center'>" + CurrentReader["IndividualHeader_Weight"] + "%</td>");
                                        HtmlCurrentKPI.Append("<td class='td-align' align='center'>" + CurrentReader["IndividualHeader_Score"] + "%</td>");
                                        HtmlCurrentKPI.Append("</tr>");
                                    }
                                }//end of While
                            }//end of if(HasRows)
                            else//jika tidak ada data period sama sekali
                            {
                                HtmlCurrentKPI.Append("<tr align='center'>");
                                HtmlCurrentKPI.Append("<th class='centering-th-period' colspan='9'>There is no data to display</th>");
                                HtmlCurrentKPI.Append("</tr>");
                            }
                            HtmlCurrentKPI.Append("</table>");
                            HtmlCurrentKPI.Append("</div>");
                            HtmlCurrentKPI.Append("</div>");
                            CurrentReader.Dispose();
                            CurrentReader.Close();
                        }//end of SqlDataReader CurrentReader
                        PlaceHolderBefore.Controls.Add(new Literal { Text = HtmlCurrentKPI.ToString() });//menampilkan table period
                    }
                    conn.Close();
                }//end of SqlConnection
            }
        }

        public string ShowMonthName(int result_value)
        {
            string month_name = "";
            switch (result_value)
            {
                case 0:
                    month_name = "-"; break;
                case 1:
                    month_name = "January"; break;
                case 2:
                    month_name = "February"; break;
                case 3:
                    month_name = "March"; break;
                case 4:
                    month_name = "April"; break;
                case 5:
                    month_name = "May"; break;
                case 6:
                    month_name = "June"; break;
                case 7:
                    month_name = "July"; break;
                case 8:
                    month_name = "August"; break;
                case 9:
                    month_name = "September"; break;
                case 10:
                    month_name = "October"; break;
                case 11:
                    month_name = "November"; break;
                case 12:
                    month_name = "December"; break;
            }
            return month_name;
        }
    }
}